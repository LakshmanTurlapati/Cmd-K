---
phase: 04-ai-command-generation
plan: 03
type: execute
wave: 3
depends_on: ["04-02"]
files_modified:
  - src/App.css
autonomous: false
requirements: [AICG-01, AICG-02]

must_haves:
  truths:
    - "User working in terminal types a natural language query and receives a working shell command"
    - "User over a non-terminal app types a question and receives a concise answer"
    - "Streaming renders token-by-token with visible block cursor"
    - "Escape cycles input/result and closes overlay correctly"
    - "Auto-copy and click-to-copy both function"
    - "Session follow-up queries reference prior context"
  artifacts:
    - path: "src/App.css"
      provides: "Shake keyframe animation for empty input submit"
      contains: "@keyframes shake"
  key_links:
    - from: "frontend overlay"
      to: "stream_ai_response Rust command"
      via: "invoke with Channel onToken callback"
      pattern: "stream_ai_response"
---

<objective>
Add the shake animation CSS keyframe, then perform end-to-end human verification of the complete Phase 4 AI command generation experience across terminal mode, assistant mode, error handling, streaming UX, keyboard navigation, and clipboard behavior.

Purpose: Verify the full integration works as intended before marking Phase 4 complete.

Output: Verified Phase 4 experience, any CSS polish applied, App.css updated.
</objective>

<execution_context>
@/Users/lakshmanturlapati/.claude/get-shit-done/workflows/execute-plan.md
@/Users/lakshmanturlapati/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/04-ai-command-generation/04-CONTEXT.md
@.planning/phases/04-ai-command-generation/04-01-SUMMARY.md
@.planning/phases/04-ai-command-generation/04-02-SUMMARY.md
@src/App.css
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add shake keyframe animation to App.css</name>
  <files>src/App.css</files>
  <action>
Add the shake keyframe animation used by CommandInput for empty submit feedback:

```css
@keyframes shake {
  0%, 100% { transform: translateX(0); }
  25% { transform: translateX(-4px); }
  75% { transform: translateX(4px); }
}
```

This is a simple CSS addition. Check existing App.css content and append the keyframe at the end without disturbing existing styles (overlay-in, overlay-out keyframes are already there).
  </action>
  <verify>
Read App.css and confirm the shake keyframe is present alongside existing keyframes.
  </verify>
  <done>
shake keyframe animation defined in App.css for CommandInput empty-submit feedback
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Task 2: Human verification of complete Phase 4 AI command generation</name>
  <files>none</files>
  <action>
Human verification of the complete Phase 4 AI command generation pipeline: Rust SSE streaming backend (ai.rs), frontend token-by-token display (ResultsArea), input/output mode transitions (displayMode state machine), two-Escape keyboard navigation, session memory (7 turns), auto-copy to clipboard, click-to-copy with indicator, error handling, and two-mode system prompts (terminal command vs assistant).

Run `npm run tauri dev` from the project root.

**Terminal Mode (8 checks):**
1. Open a terminal (Terminal.app or iTerm2), navigate to a directory with files
2. Press Cmd+K (or configured hotkey) -- overlay appears with "Ask anything..." placeholder
3. Type "list all files modified today" and press Enter
4. Verify: input transforms to output area, tokens stream in monospace font with block cursor blinking
5. Verify: block cursor disappears when streaming completes
6. Verify: badge (e.g., "zsh") visible below the output area
7. Press Cmd+V in terminal -- verify the command was auto-copied to clipboard
8. Verify: the generated command uses POSIX tools (find/ls, not fd/exa)

**Escape Flow (3 checks):**
9. While output is showing, press Escape once -- verify returns to input mode with previous query restored
10. Edit the query text and press Enter -- verify new response replaces old (not stacked)
11. Press Escape again from input mode -- verify overlay closes

**Assistant Mode (3 checks):**
12. Switch to a non-terminal app (e.g., Finder, browser without DevTools)
13. Open overlay, type "what is the capital of France" and press Enter
14. Verify: response is 2-3 sentences max, plain text (not a command), still in monospace

**Session Memory (2 checks):**
15. Open overlay over terminal, type "list all js files" and press Enter
16. After response, press Escape to return to input, type "now only the ones modified this week" -- verify AI references the previous query context

**Click-to-Copy (2 checks):**
17. With a result displayed, click the output area -- verify "Copied to clipboard" indicator appears briefly at bottom-right
18. Paste elsewhere to confirm clipboard content matches

**Error Handling (3 checks):**
19. Delete API key in Settings, then submit a query -- verify "No API key configured. Open Settings to add one." error appears inline
20. Press Enter with empty input -- verify input field shakes briefly (no API call made)
21. Re-add API key and verify normal streaming resumes

**Overlay Sizing (1 check):**
22. Submit a query that generates a long multi-line response -- verify overlay grows vertically but caps at ~60% screen height with scroll
  </action>
  <verify>
All 22 verification steps pass. Terminal mode generates working commands, assistant mode generates concise answers, streaming renders token-by-token, Escape flow works, clipboard integration functions, error handling is graceful, and overlay sizing adapts correctly.
  </verify>
  <done>
Human has verified: AI command generation works end-to-end across terminal and assistant modes, streaming UX with block cursor, two-Escape keyboard flow, session memory, auto-copy and click-to-copy clipboard integration, error handling, empty submit shake, and adaptive overlay sizing. Phase 4 requirements AICG-01 and AICG-02 are satisfied.
  </done>
</task>

</tasks>

<verification>
All 22 verification steps pass in the human verification checkpoint.
</verification>

<success_criteria>
- Terminal mode generates working shell commands appropriate for macOS + detected shell
- Assistant mode generates concise text answers (not commands)
- Streaming, Escape flow, clipboard, error handling all function as designed
- Phase 4 requirements AICG-01 and AICG-02 are fully satisfied
</success_criteria>

<output>
After completion, create `.planning/phases/04-ai-command-generation/04-03-SUMMARY.md`
</output>
