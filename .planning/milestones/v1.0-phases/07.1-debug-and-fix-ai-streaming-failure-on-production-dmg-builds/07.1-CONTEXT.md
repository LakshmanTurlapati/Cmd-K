# Phase 07.1: Debug and Fix AI Streaming Failure on Production DMG Builds - Context

**Gathered:** 2026-02-26
**Status:** Ready for planning

<domain>
## Phase Boundary

Fix terminal pasting in production DMG builds. The AI streaming and overlay UI work correctly -- responses appear in the overlay as expected. The failure is specifically in pasting the generated command to the terminal. The terminal cursor activates (focus shifts) but no command text is written. This affects all terminals (Terminal.app, iTerm2, etc.) in the production DMG build. Dev builds (`cargo tauri dev`) work fine.

</domain>

<decisions>
## Implementation Decisions

### Actual failure point
- NOT AI streaming -- that works fine in the overlay UI
- The failure is in paste_to_terminal: the AppleScript-based terminal pasting (Phase 6 feature)
- Terminal gets focus/activation (cursor activates) but no text is typed/pasted
- Affects ALL terminal apps, not just one specific terminal

### Observed behavior
- Accessibility permissions work correctly in the DMG build
- Terminal/app detection works correctly in the DMG build
- AI query submission and streaming response in overlay UI works correctly
- Only the final step -- writing the command to the terminal -- fails silently
- Terminal cursor activates suggesting the app switching/focus part of AppleScript works, but the keystroke/write text portion does not execute

### Diagnosis approach
- Check system logs (Console.app) for AppleScript errors or sandbox violations from the DMG build
- Compare entitlements and hardened runtime settings between dev and production builds
- Investigate whether AppleScript automation permissions are being requested/granted for the production app bundle
- Check if the DMG build's code signing or notarization affects AppleScript capabilities
- Look at Tauri's production build config for sandboxing or entitlement differences

### Claude's Discretion
- Specific debugging methodology and tooling
- Whether fix requires entitlements changes, code changes, or both
- Whether to add runtime logging for future production debugging

</decisions>

<specifics>
## Specific Ideas

- "Feel free to use the system logs to see what happened" -- user expects log-based diagnosis
- The fact that terminal focus/activation works but text entry doesn't suggests AppleScript automation permission is partially working (can activate apps) but keystroke/write text commands are blocked
- This is likely a hardened runtime or entitlements issue specific to production DMG builds where AppleScript automation requires explicit entitlements

</specifics>

<deferred>
## Deferred Ideas

None -- discussion stayed within phase scope

</deferred>

---

*Phase: 07.1-debug-and-fix-ai-streaming-failure-on-production-dmg-builds*
*Context gathered: 2026-02-26*
