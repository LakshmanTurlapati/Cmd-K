---
phase: 01-foundation-overlay
plan: 02
type: execute
wave: 2
depends_on:
  - 01-01
files_modified:
  - src/App.tsx
  - src/components/Overlay.tsx
  - src/components/CommandInput.tsx
  - src/components/ResultsArea.tsx
  - src/store/index.ts
  - src/hooks/useKeyboard.ts
  - src/styles.css
autonomous: true
requirements:
  - OVRL-02
  - OVRL-03

must_haves:
  truths:
    - "Overlay appears with Spotlight-like fade-in and scale-up animation"
    - "Input field auto-focuses immediately when overlay appears"
    - "User can type text and the input field grows vertically for long input"
    - "Pressing Escape dismisses the overlay without affecting underlying app"
    - "Clicking outside the overlay panel dismisses it"
    - "Pressing Enter with text shows inline 'API not configured' message"
    - "Empty results area is visible below input, ready for Phase 4"
    - "Shift+Enter inserts a newline instead of submitting"
  artifacts:
    - path: "src/components/Overlay.tsx"
      provides: "Root overlay panel with frosted glass styling, animation, shadow"
      min_lines: 30
    - path: "src/components/CommandInput.tsx"
      provides: "Auto-focus textarea with grow behavior, Enter/Shift+Enter handling"
      min_lines: 40
    - path: "src/components/ResultsArea.tsx"
      provides: "Empty results placeholder for Phase 4 AI output"
      min_lines: 15
    - path: "src/store/index.ts"
      provides: "Zustand store for overlay visibility and input state"
      exports: ["useOverlayStore"]
    - path: "src/hooks/useKeyboard.ts"
      provides: "Escape key listener that calls hide_overlay"
      exports: ["useKeyboard"]
  key_links:
    - from: "src/components/CommandInput.tsx"
      to: "hide_overlay"
      via: "invoke('hide_overlay') on Escape press"
      pattern: "invoke.*hide_overlay"
    - from: "src/App.tsx"
      to: "src/store/index.ts"
      via: "useOverlayStore for visibility state"
      pattern: "useOverlayStore"
    - from: "src/App.tsx"
      to: "overlay-shown event"
      via: "Tauri event listener triggers visibility state"
      pattern: "listen.*overlay-shown"
---

<objective>
Build the complete React frontend UI for the overlay panel: Overlay wrapper with frosted glass styling and animation, CommandInput with auto-focus and grow behavior, ResultsArea placeholder, Zustand state management, and all keyboard/mouse dismiss interactions. The overlay must match the Cursor Cmd+K terminal assist aesthetic -- translucent panel with shadow, not a flat web UI.

Purpose: Deliver the user-facing overlay experience that makes CMD+K feel like a native macOS tool.
Output: Fully interactive overlay UI that responds to show/hide commands from the Rust backend.
</objective>

<execution_context>
@/Users/lakshmanturlapati/.claude/get-shit-done/workflows/execute-plan.md
@/Users/lakshmanturlapati/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-foundation-overlay/01-RESEARCH.md
@.planning/phases/01-foundation-overlay/01-CONTEXT.md
@.planning/phases/01-foundation-overlay/01-01-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Zustand store and keyboard hook for overlay state management</name>
  <files>
    src/store/index.ts
    src/hooks/useKeyboard.ts
  </files>
  <action>
    **src/store/index.ts:**
    Create Zustand store managing overlay state:
    ```typescript
    interface OverlayState {
      visible: boolean;
      inputValue: string;
      submitted: boolean;
      showApiWarning: boolean;
      show: () => void;
      hide: () => void;
      setInputValue: (value: string) => void;
      submit: () => void;
      reset: () => void;
    }
    ```

    - `show()`: sets `visible: true`, resets `inputValue`, `submitted`, `showApiWarning`
    - `hide()`: sets `visible: false`
    - `submit()`: sets `submitted: true`, `showApiWarning: true` (Phase 1 always shows API warning since no API is configured yet)
    - `reset()`: clears `inputValue`, `submitted`, `showApiWarning` (called when overlay opens)

    **src/hooks/useKeyboard.ts:**
    Create a React hook that:
    1. Listens for global `keydown` events
    2. On `Escape` key: calls `invoke('hide_overlay')` from `@tauri-apps/api/core` AND updates store `hide()`
    3. Cleanup on unmount
    4. Export as `useKeyboard`

    Also set up a Tauri event listener using `listen` from `@tauri-apps/api/event`:
    - Listen for `overlay-shown` event from Rust backend
    - When received, call store `show()` to sync frontend state
    - Listen for `overlay-hidden` event (if emitted), call store `hide()`
    - This ensures frontend state stays in sync with Rust panel visibility
  </action>
  <verify>
    - `src/store/index.ts` exports `useOverlayStore` with all state fields and actions
    - `src/hooks/useKeyboard.ts` exports `useKeyboard` hook
    - TypeScript compiles without errors: `pnpm tsc --noEmit`
  </verify>
  <done>
    Zustand store manages overlay visibility, input value, and submission state. Keyboard hook handles Escape dismiss via Tauri IPC. Event listeners sync frontend state with Rust backend panel visibility.
  </done>
</task>

<task type="auto">
  <name>Task 2: Build Overlay, CommandInput, and ResultsArea components with animations and interactions</name>
  <files>
    src/components/Overlay.tsx
    src/components/CommandInput.tsx
    src/components/ResultsArea.tsx
    src/App.tsx
    src/styles.css
  </files>
  <action>
    **src/components/Overlay.tsx:**
    Root overlay panel component:
    - Renders a container div with:
      - Width: `w-[640px]` (matches Cursor Cmd+K reference per research)
      - Rounded corners: `rounded-xl` (12px to match vibrancy corner radius)
      - Shadow: `shadow-2xl` for depth separation (no background dimming per CONTEXT.md)
      - Semi-transparent dark background: `bg-black/60` or similar to complement the native vibrancy effect showing through the transparent window. The native `HudWindow` vibrancy handles the frosted glass -- the CSS adds a tinted overlay on top.
      - Subtle border: `border border-white/10` for edge definition
    - Animation: Use the `overlay-in` and `overlay-out` keyframes from styles.css
      - When `visible=true`: apply `animate-[overlay-in_120ms_ease-out]`
      - When `visible=false`: apply `animate-[overlay-out_100ms_ease-in]` and use `onAnimationEnd` to unmount or hide
      - Use a state variable to track animation phase (entering, visible, exiting, hidden) so the component stays mounted during exit animation
    - Contains `<CommandInput />` and `<ResultsArea />` as children
    - Padding: `p-4` for inner spacing

    **src/components/CommandInput.tsx:**
    Auto-focus, auto-growing textarea input:
    - Use a `<textarea>` element (not `<input>`) to support Shift+Enter newlines
    - `rows={1}` initial, with auto-grow behavior:
      - On `onChange`: set `style.height = 'auto'` then `style.height = scrollHeight + 'px'`
      - Max height: cap at ~200px with `max-h-[200px] overflow-y-auto`
    - Placeholder text: `"Describe a task or type a command..."` (exact text from CONTEXT.md)
    - Auto-focus: `useEffect` that calls `ref.current?.focus()` when component mounts. Also re-focus when overlay becomes visible (listen to store `visible` state)
    - Keyboard handling:
      - `Enter` (without Shift): `e.preventDefault()`, call `onSubmit(value)` prop
      - `Shift+Enter`: do nothing (default textarea behavior inserts newline)
      - `Escape`: handled by `useKeyboard` hook (not here, to avoid duplication)
    - Styling: transparent background, white text, placeholder in white/40 opacity, no outline/ring, `resize-none`
    - Props: `onSubmit: (value: string) => void`

    **src/components/ResultsArea.tsx:**
    Empty results placeholder for Phase 4:
    - Renders below CommandInput with a subtle separator (thin line or spacing)
    - When `showApiWarning` is true in store: show an inline message:
      - Text: "API not configured" with a subtle link/button "Set up in Settings"
      - Styling: muted text color (white/50), small font, centered
      - The "Set up in Settings" triggers an event to open settings (placeholder for Phase 2 -- just log or emit event for now)
    - When not submitted yet: show nothing or a very subtle empty state (empty div with min-height to reserve space)
    - This area will be populated by AI command output in Phase 4

    **src/App.tsx:**
    Wire everything together:
    - Import and use `useOverlayStore` for visibility
    - Import and invoke `useKeyboard` hook
    - Set up click-outside dismiss:
      - Wrap overlay in a full-screen transparent container
      - Attach `onMouseDown` to the outer container
      - If click target is the outer container (not the overlay panel), call `invoke('hide_overlay')` and store `hide()`
      - Use a `ref` on the overlay panel to check `contains(e.target)`
    - Render `<Overlay />` component
    - The entire page background must be transparent (html/body already set in styles.css from Plan 01)
    - Set up Tauri event listeners in a `useEffect`:
      - `listen('overlay-shown', () => store.show())`
      - This keeps frontend in sync when Rust shows the panel via hotkey

    **src/styles.css updates:**
    - Ensure the overlay animation keyframes exist (from Plan 01)
    - Add any additional utility styles needed
    - Ensure body has `overflow: hidden` to prevent scrollbars on the transparent window
    - Add `-webkit-user-select: none` on the outer container (prevent text selection on the transparent background area)
    - But allow text selection inside the overlay panel itself
  </action>
  <verify>
    - `pnpm tsc --noEmit` compiles without TypeScript errors
    - `pnpm build` (Vite) produces output without errors
    - Overlay.tsx renders a 640px wide panel with rounded corners and shadow
    - CommandInput.tsx has textarea with placeholder "Describe a task or type a command..."
    - CommandInput.tsx has Enter submit and Shift+Enter newline handling
    - ResultsArea.tsx shows "API not configured" message when submitted
    - App.tsx has click-outside dismiss logic with ref check
    - App.tsx has Tauri event listener for overlay-shown
  </verify>
  <done>
    Complete overlay UI renders: 640px frosted glass panel with fade-in/scale-up animation, auto-focus textarea input with grow behavior and correct keyboard handling (Enter=submit, Shift+Enter=newline, Escape=dismiss), click-outside dismiss, inline "API not configured" message on submit, and empty results area placeholder ready for Phase 4 AI output.
  </done>
</task>

</tasks>

<verification>
- `pnpm tauri dev` launches and the overlay UI renders inside the transparent window
- Overlay has visible frosted glass effect with shadow
- Input auto-focuses when overlay appears via hotkey
- Typing text shows in the input field with correct placeholder
- Enter key triggers submission showing "API not configured" message
- Shift+Enter inserts a newline in the input
- Escape key dismisses the overlay
- Clicking outside the overlay panel dismisses it
- Overlay appears with smooth fade-in + scale-up animation
</verification>

<success_criteria>
The overlay UI is fully interactive: appears with animation on hotkey press, auto-focuses input, supports typing with grow behavior, handles Enter/Shift+Enter/Escape correctly, dismisses on click-outside, shows "API not configured" inline message on submission, and has a results area placeholder. The frontend syncs with the Rust backend via Tauri IPC and events.
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation-overlay/01-02-SUMMARY.md`
</output>
